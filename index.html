<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pastel Kanban</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f9f6ef;
  --text:#1b1b1f;
  --muted:#6f6f76;
  --card:#fff;
  --radius:14px;
  --ring:0 0 0 2px rgba(0,0,0,0.06);

  --design:258,100%,86%;
  --dev:174,70%,80%;
  --research:44,100%,84%;
  --bug:0,100%,82%;
  --chore:200,100%,85%;
}

*{box-sizing:border-box}
html,body{height:100%}

body{
  margin:0;
  font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji";
  color:var(--text);
  background:
    radial-gradient(1200px 800px at 20% -10%,rgba(255,255,255,0.8),transparent),
    radial-gradient(1000px 700px at 100% 20%,hsla(var(--design),0.25),transparent),
    radial-gradient(900px 600px at -10% 100%,hsla(var(--dev),0.25),transparent),
    var(--bg);
}

/* ================= HEADER / LEGEND ================= */

.app-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:16px;
  padding:28px clamp(16px,4vw,40px);
}

.app-header h1{
  margin:0;
  font-size:clamp(22px,3.2vw,32px);
  letter-spacing:-0.02em;
  font-weight:600;
}

/* Legend chips */
.legend{display:flex;gap:8px;flex-wrap:wrap}

.chip{
  padding:6px 10px;
  border-radius:999px;
  background:#fff;
  box-shadow:var(--ring);
  font-size:12px;
  color:var(--muted);
  border:none;
}

.cat-design{background:hsla(var(--design),0.22);color:#5d4bb3;box-shadow:0 0 0 1.5px hsla(var(--design),0.55) inset}
.cat-dev{background:hsla(var(--dev),0.22);color:#287e6b;box-shadow:0 0 0 1.5px hsla(var(--dev),0.55) inset}
.cat-research{background:hsla(var(--research),0.22);color:#8a6a00;box-shadow:0 0 0 1.5px hsla(var(--research),0.5) inset}
.cat-bug{background:hsla(var(--bug),0.22);color:#9a2b2b;box-shadow:0 0 0 1.5px hsla(var(--bug),0.55) inset}
.cat-chore{background:hsla(var(--chore),0.22);color:#1e5d8f;box-shadow:0 0 0 1.5px hsla(var(--chore),0.55) inset}

/* Legend + button */
.legend-wrap{margin-left:auto;display:flex;align-items:center;gap:10px}

.legend-plus{
  width:28px;
  height:28px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border-radius:999px;
  border:1px solid rgba(0,0,0,0.06);
  background:#fff;
  box-shadow:var(--ring);
  cursor:pointer;
  color:var(--muted);
  font-weight:600;
}

.legend-plus:hover{background:#fafafa}

/* ================= BOARD ================= */

.board{
  display:grid;
  grid-template-columns:repeat(4,minmax(240px,1fr));
  gap:18px;
  padding:0 clamp(16px,4vw,40px) 40px;
}

.column{
  background:rgba(255,255,255,0.65);
  backdrop-filter:saturate(120%) blur(6px);
  border:1px solid rgba(0,0,0,0.06);
  border-radius:var(--radius);
  box-shadow:0 8px 30px rgba(0,0,0,0.06);
  display:flex;
  flex-direction:column;
  min-height:320px;
}

.column header{padding:14px 14px 6px 14px}

.column h2{
  margin:0;
  font-size:14px;
  letter-spacing:0.12em;
  text-transform:uppercase;
  color:var(--muted);
  font-weight:500;
}

/* Quick add */
.quick-add{
  display:grid;
  grid-template-columns:1fr 110px auto;
  gap:8px;
  padding:10px 14px 14px 14px;
}

.quick-add input,
.quick-add select,
.quick-add button{
  font:inherit;
  font-size:15px;
  font-weight:400;
}

.quick-add input{
  height:36px;
  border-radius:10px;
  border:1px solid rgba(0,0,0,0.08);
  padding:0 12px;
  background:#fff;
  outline:none;
  transition:border-color 200ms ease,box-shadow 200ms ease;
  box-shadow:0 1px 2px rgba(0,0,0,0.05);
}

.quick-add button{
  height:36px;
  min-width:36px;
  padding:0 10px;
  border-radius:10px;
  border:1px solid rgba(0,0,0,0.08);
  background:#fff;
  cursor:pointer;
  font-size:14px;
  transition:background 200ms ease,border-color 200ms ease;
}

/* ================= CARDS ================= */

.cards{
  display:flex;
  flex-direction:column;
  gap:12px;
  padding:0 14px 16px 14px;
  min-height:100px;
}

.card{
  background:var(--card);
  border-radius:16px;
  border:1px solid rgba(0,0,0,0.06);
  box-shadow:0 10px 30px rgba(0,0,0,0.06);
  padding:12px;
  cursor:grab;
  transition:transform 120ms ease,box-shadow 160ms ease,background 160ms ease;
  overflow:hidden;
}

.card.cat-design{background:hsla(var(--design),0.22);box-shadow:0 0 0 1px hsla(var(--design),0.55) inset,0 10px 30px hsla(var(--design),0.35)}
.card.cat-dev{background:hsla(var(--dev),0.22);box-shadow:0 0 0 1px hsla(var(--dev),0.55) inset,0 10px 30px hsla(var(--dev),0.35)}
.card.cat-research{background:hsla(var(--research),0.22);box-shadow:0 0 0 1px hsla(var(--research),0.5) inset,0 10px 30px hsla(var(--research),0.35)}
.card.cat-bug{background:hsla(var(--bug),0.22);box-shadow:0 0 0 1px hsla(var(--bug),0.55) inset,0 10px 30px hsla(var(--bug),0.35)}
.card.cat-chore{background:hsla(var(--chore),0.22);box-shadow:0 0 0 1px hsla(var(--chore),0.55) inset,0 10px 30px hsla(var(--chore),0.35)}

.card-top{
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap:8px;
  margin-bottom:6px;
}

/* ================= CATEGORY MODAL ================= */

.modal-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.2);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.modal{
  width:min(280px,92vw);
  background:#fff;
  border-radius:16px;
  border:1px solid rgba(0,0,0,0.06);
  box-shadow:0 20px 60px rgba(0,0,0,0.18);
  padding:18px;
}

.modal h3{
  margin:4px 0 28px 0;
  font-size:14px;
  letter-spacing:0.12em;
  text-transform:uppercase;
  color:var(--muted);
  font-weight:500;
  text-align:center;
}

.modal-actions{
  display:flex;
  justify-content:center;
  gap:10px;
  margin-top:32px;
}

.btn{
  height:40px;
  padding:0 24px;
  border-radius:14px;
  border:1px solid rgba(0,0,0,0.08);
  background:#fff;
  cursor:pointer;
  font-size:14px;
  font-weight:500;
  letter-spacing:0.12em;
  text-transform:uppercase;
  transition:background 200ms ease,border-color 200ms ease;
}

.btn.primary{
  background:#666;
  color:#fff;
  border-color:#666;
}

/* ================= NEW PASTEL COLOR PICKER ================= */

.picker-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.2);
  z-index:10000;
  display:none;
}

.picker-backdrop.active{display:block}

.color-picker-popup{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#fff;
  border-radius:18px;
  padding:20px;
  box-shadow:0 20px 60px rgba(0,0,0,0.25);
  z-index:10001;
  display:none;
  width:320px;
}

.color-picker-popup.active{display:block}

/* Big preview — matches task cards */
.color-preview-large{
  width:100%;
  height:70px;
  border-radius:16px;
  border:1px solid rgba(0,0,0,0.06);
  margin-bottom:14px;
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.5) inset,
    0 10px 30px rgba(0,0,0,0.18);
}

/* Hex input — SAME WIDTH AS COLOR FIELD */
.hex-input{
  width:100%;
  height:36px;
  border-radius:10px;
  border:1px solid rgba(0,0,0,0.08);
  padding:0 12px;
  font-family:monospace;
  font-size:13px;
  margin-bottom:14px;
}

/* ---- SOFT PASTEL COLOR FIELD ---- */
.color-field-wrapper{
  position:relative;
  width:100%;
  aspect-ratio: 1 / 1;
  border-radius:16px;
  overflow:hidden;
  border:1px solid rgba(0,0,0,0.08);
  box-shadow:0 4px 12px rgba(0,0,0,0.08) inset;
  margin-bottom:16px;
  cursor:crosshair;
}

/* Softer, more pastel hues left → right */
.color-field{
  position:absolute;
  inset:0;
  background:
    linear-gradient(to right,
      hsl(0,55%,88%),
      hsl(60,55%,88%),
      hsl(120,55%,88%),
      hsl(180,55%,88%),
      hsl(240,55%,88%),
      hsl(300,55%,88%),
      hsl(360,55%,88%)
    );
}

/* Lightness top → bottom: WHITE → SOFT GREY (not black) */
.color-field::after{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(
    to bottom,
    rgba(255,255,255,0.9),
    rgba(120,120,120,0.35)
  );
  mix-blend-mode:multiply;
}

/* Soft thumb */
.color-thumb{
  position:absolute;
  width:22px;
  height:22px;
  border-radius:50%;
  border:2px solid rgba(0,0,0,0.4);
  background:#fff;
  transform:translate(-50%,-50%);
  pointer-events:none;
  box-shadow:0 2px 6px rgba(0,0,0,0.25);
}

/* Picker buttons */
.picker-actions{
  display:flex;
  justify-content:center;
  gap:10px;
}

/* Responsive */
@media (max-width:900px){.board{grid-template-columns:1fr}}
</style>
</head>

<body>

<header class="app-header">
  <div class="legend-wrap">
    <div class="legend">
      <span class="chip cat-design">Design</span>
      <span class="chip cat-dev">Dev</span>
      <span class="chip cat-research">Research</span>
      <span class="chip cat-bug">Bug</span>
      <span class="chip cat-chore">Chore</span>
    </div>
    <button class="legend-plus" id="open-colors">＋</button>
  </div>
</header>

<main class="board" id="board">
<!-- Columns unchanged -->
<section class="column" data-col="todo"><header><h2>To Do</h2></header>
<form class="quick-add" data-target="todo">
<input type="text" name="title" placeholder="Add a task…"/>
<button type="submit">＋</button>
</form>
<div class="cards" data-list="todo"></div>
</section>

<section class="column" data-col="next"><header><h2>Do Next</h2></header>
<form class="quick-add" data-target="next">
<input type="text" name="title" placeholder="Add a task…"/>
<button type="submit">＋</button>
</form>
<div class="cards" data-list="next"></div>
</section>

<section class="column" data-col="doing"><header><h2>Doing</h2></header>
<form class="quick-add" data-target="doing">
<input type="text" name="title" placeholder="Add a task…"/>
<button type="submit">＋</button>
</form>
<div class="cards" data-list="doing"></div>
</section>

<section class="column" data-col="done"><header><h2>Done</h2></header>
<form class="quick-add" data-target="done">
<input type="text" name="title" placeholder="Add a task…"/>
<button type="submit">＋</button>
</form>
<div class="cards" data-list="done"></div>
</section>
</main>

<template id="card-template">
  <article class="card" draggable="true">
    <div class="card-top"><button class="icon-button del">✕</button></div>
    <div class="title" contenteditable="true" spellcheck="false"></div>
  </article>
</template>

<!-- CATEGORY MODAL -->
<div class="modal-backdrop" id="color-modal">
  <div class="modal">
    <h3>Customize Categories</h3>
    <div class="modal-actions">
      <button class="btn" id="cancel-colors">Cancel</button>
      <button class="btn primary" id="save-colors">Save</button>
    </div>
  </div>
</div>

<!-- NEW COLOR PICKER -->
<div class="picker-backdrop" id="picker-backdrop"></div>

<div class="color-picker-popup" id="color-picker-popup">

  <div class="color-preview-large" id="color-preview-large"></div>

  <!-- HEX INPUT WITH # INSIDE -->
  <input type="text"
         class="hex-input"
         id="hex-input"
         maxlength="7"
         placeholder="#FFFFFF">

  <div class="color-field-wrapper" id="color-field-wrapper">
    <div class="color-field" id="color-field"></div>
    <div class="color-thumb" id="color-thumb"></div>
  </div>

  <div class="picker-actions">
    <button class="btn" id="picker-cancel">Cancel</button>
    <button class="btn primary" id="picker-save">Save</button>
  </div>
</div>

<script>
/* ===================== STATE ===================== */
const K='flowboard:v1';

function load(){
  try{
    const r=localStorage.getItem(K);
    return r?JSON.parse(r):null;
  }catch(e){return null}
}

const state=load()||{
  columns:{todo:[],next:[],doing:[],done:[]},
  colors:null,
  categories:[]
};

function save(){localStorage.setItem(K,JSON.stringify(state))}
function uid(){return Math.random().toString(36).slice(2,9)}

/* ===================== RENDER ===================== */
const board=document.getElementById('board'),
      tpl=document.getElementById('card-template');

function render(){
 ['todo','next','doing','done'].forEach(c=>{
  const l=board.querySelector(`[data-list="${c}"]`);
  l.innerHTML='';
  state.columns[c].forEach(card=>l.appendChild(renderCard(card)));
 });
}

function renderCard(c){
 const n=tpl.content.firstElementChild.cloneNode(true);
 n.dataset.id=c.id;
 n.classList.add(`cat-${c.category}`);
 const t=n.querySelector('.title');
 t.textContent=c.title;
 return n;
}

/* ===================== NEW PICKER LOGIC ===================== */
const pickerPopup=document.getElementById('color-picker-popup'),
      pickerBackdrop=document.getElementById('picker-backdrop'),
      colorField=document.getElementById('color-field-wrapper'),
      colorThumb=document.getElementById('color-thumb'),
      hexInput=document.getElementById('hex-input'),
      colorPreviewLarge=document.getElementById('color-preview-large'),
      pickerCancel=document.getElementById('picker-cancel'),
      pickerSave=document.getElementById('picker-save');

let currentHue=180;
let currentLightness=80;
let dragging=false;

function hslToHex(h,s,l){
 s/=100;l/=100;
 const k=n=>(n+h/30)%12,
 a=s*Math.min(l,1-l),
 f=n=>l-a*Math.max(-1,Math.min(k(n)-3,Math.min(9-k(n),1))),
 toHex=x=>Math.round(255*x).toString(16).padStart(2,'0');
 return`#${toHex(f(0))}${toHex(f(8))}${toHex(f(4))}`;
}

function hexToHsl(hex){
 let r=0,g=0,b=0;
 hex=hex.replace('#','');
 if(hex.length===3){
  r=parseInt(hex[0]+hex[0],16);
  g=parseInt(hex[1]+hex[1],16);
  b=parseInt(hex[2]+hex[2],16);
 } else{
  r=parseInt(hex.substring(0,2),16);
  g=parseInt(hex.substring(2,4),16);
  b=parseInt(hex.substring(4,6),16);
 }
 r/=255;g/=255;b/=255;
 const max=Math.max(r,g,b),min=Math.min(r,g,b);
 let h,s,l=(max+min)/2;
 if(max===min){h=0;s=0}
 else{
  const d=max-min;
  s=l>0.5?d/(2-max-min):d/(max+min);
  switch(max){
   case r:h=(g-b)/d+(g<b?6:0);break;
   case g:h=(b-r)/d+2;break;
   case b:h=(r-g)/d+4;break;
  }
  h*=60;
 }
 return{h:Math.round(h),s:Math.round(s*100),l:Math.round(l*100)};
}

function updatePreviewFromHSL(h,l){
 const hex=hslToHex(h,55,l);
 hexInput.value=hex.toUpperCase();

 const {h:hh,s,ll}=hexToHsl(hex);
 colorPreviewLarge.style.background=`hsla(${hh},${s}%,${ll}%,0.22)`;
 colorPreviewLarge.style.boxShadow=
    `0 0 0 1px hsla(${hh},${s}%,${ll}%,0.55) inset,`+
    `0 10px 30px hsla(${hh},${s}%,${ll}%,0.35)`;
}

/* Move thumb + update */
function setFromPosition(x,y){
 const rect=colorField.getBoundingClientRect();
 const cx=Math.max(0,Math.min(rect.width,x));
 const cy=Math.max(0,Math.min(rect.height,y));

 currentHue=Math.round((cx/rect.width)*360);
 currentLightness=Math.round((1 - cy/rect.height)*100);

 colorThumb.style.left=cx+'px';
 colorThumb.style.top=cy+'px';

 updatePreviewFromHSL(currentHue,currentLightness);
}

colorField.addEventListener('mousedown',e=>{
 dragging=true;
 const rect=colorField.getBoundingClientRect();
 setFromPosition(e.clientX-rect.left,e.clientY-rect.top);
});

document.addEventListener('mousemove',e=>{
 if(!dragging) return;
 const rect=colorField.getBoundingClientRect();
 setFromPosition(e.clientX-rect.left,e.clientY-rect.top);
});

document.addEventListener('mouseup',()=>dragging=false);

/* Picker open/close */
function showColorPicker(){
 const rect=colorField.getBoundingClientRect();
 const x=(currentHue/360)*rect.width;
 const y=(1-currentLightness/100)*rect.height;

 colorThumb.style.left=x+'px';
 colorThumb.style.top=y+'px';

 updatePreviewFromHSL(currentHue,currentLightness);
 pickerPopup.classList.add('active');
 pickerBackdrop.classList.add('active');
}

function hideColorPicker(){
 pickerPopup.classList.remove('active');
 pickerBackdrop.classList.remove('active');
}

pickerCancel.addEventListener('click',hideColorPicker);
pickerSave.addEventListener('click',hideColorPicker);
pickerBackdrop.addEventListener('click',hideColorPicker);

/* Open picker from legend + button */
document.getElementById('open-colors').addEventListener('click',showColorPicker);

/* Initial render */
render();
</script>
</body>
</html>
